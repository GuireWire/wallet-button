<!DOCTYPE html>
<html>

<head>
    <!-- Manrope font from Framer -->
    <link href="https://api.fontshare.com/v2/css?f[]=manrope@700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Manrope';
            font-weight: 700;
            font-display: swap;
            src: url('https://framerusercontent.com/assets/0kF4T3RnZOnV9U7GQD3JjzpUxE.ttf') format('truetype');
        }

        :root {
            --token-2507b644-ca70-48b4-8a80-9e3124a5c985: rgb(250, 250, 250);
            --token-2e55662e-d6bf-4329-b432-3c735e37723b: rgb(17, 17, 17);
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .framer-button {
            background-color: var(--token-2507b644-ca70-48b4-8a80-9e3124a5c985, rgb(250, 250, 250));
            border-radius: 50px;
            opacity: 1;
            cursor: pointer;
            padding: 12px 24px;
        }

        .framer-container {
            outline: none;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            flex-shrink: 0;
            --extracted-r6o4lv: var(--variable-reference-oPPvRVjNa-lpvuElQK4);
            --framer-paragraph-spacing: 0px;
            --variable-reference-gJtx4y_sc-lpvuElQK4: var(--token-2e55662e-d6bf-4329-b432-3c735e37723b, rgb(17, 17, 17));
            --variable-reference-oPPvRVjNa-lpvuElQK4: var(--token-2e55662e-d6bf-4329-b432-3c735e37723b, rgb(17, 17, 17));
            transform: none;
            opacity: 1;
        }

        .framer-text {
            --font-selector: R0Y7TWFucm9wZS03MDA=;
            --framer-font-family: "Manrope", "Manrope Placeholder", sans-serif;
            --framer-font-weight: 700;
            --framer-line-height: 110%;
            --framer-text-color: var(--extracted-r6o4lv, var(--variable-reference-oPPvRVjNa-lpvuElQK4));
            margin: 0;
        }
    </style>
</head>

<body>
    <span class="framer-button" id="connect-btn" onclick="toggleWallet()">
        <div class="framer-container">
            <p class="framer-text" id="connect-text">Connect</p>
        </div>
    </span>

    <script>
        let isConnected = false;
        let currentAccount = null;

        // Check initial connection status
        async function checkConnection() {
            if (typeof window.ethereum !== "undefined") {
                const accounts = await window.ethereum.request({
                    method: "eth_accounts"  // This doesn't prompt, just checks
                });
                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    isConnected = true;
                    document.getElementById("connect-text").textContent =
                        "Disconnect (" + currentAccount.slice(0, 6) + "...)";
                }
            }
        }

        async function toggleWallet() {
            if (!isConnected) {
                await connectWallet();
            } else {
                await disconnectWallet();
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum !== "undefined") {
                try {
                    const accounts = await window.ethereum.request({
                        method: "eth_requestAccounts"
                    });
                    currentAccount = accounts[0];
                    isConnected = true;
                    document.getElementById("connect-text").textContent =
                        "Disconnect (" + currentAccount.slice(0, 6) + "...)";
                } catch (error) {
                    console.error("Error connecting:", error);
                    document.getElementById("connect-text").textContent =
                        "Error connecting";
                }
            } else {
                alert("Please install MetaMask!");
                document.getElementById("connect-text").textContent =
                    "Install MetaMask";
            }
        }

        async function disconnectWallet() {
            try {
                // Clear our state
                isConnected = false;
                currentAccount = null;

                // Reset the button text
                document.getElementById("connect-text").textContent = "Connect";

                // Force MetaMask to forget the connection
                if (window.ethereum && window.ethereum.removeAllListeners) {
                    window.ethereum.removeAllListeners('accountsChanged');
                    setupAccountChangeListener(); // Reset the listener
                }
            } catch (error) {
                console.error("Error disconnecting:", error);
            }
        }

        function setupAccountChangeListener() {
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        // User disconnected their wallet
                        disconnectWallet();
                    } else {
                        // Account changed, update the display
                        currentAccount = accounts[0];
                        isConnected = true;
                        document.getElementById("connect-text").textContent =
                            "Disconnect (" + currentAccount.slice(0, 6) + "...)";
                    }
                });
            }
        }

        // Setup initial listeners
        setupAccountChangeListener();
    </script>
</body>

</html>